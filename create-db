CREATE TABLE Category (
    name        VARCHAR (254),
    timestamp   TIMESTAMP     NOT NULL,
    PRIMARY KEY (name)
)

CREATE TABLE Thread (
    id          INT,
    name        VARCHAR (254)   NOT NULL,
    username    VARCHAR (254)   NOT NULL,
    PRIMARY KEY (id),
    FOREIGN KEY (username) REFERENCES User(username)
)

CREATE TABLE User (
    username        VARCHAR (32)    NOT NULL,
    email           VARCHAR (120)   NOT NULL,
    passwordhash    VARCHAR (40)    NOT NULL,
    reputation      INT             DEFAULT '0',
    role            INT             DEFAULT '0',
    PRIMARY KEY username
)

CREATE TABLE Message (
    id              INT             NOT NULL,
    message         TEXT            NOT NULL,
    timestamp       TIMESTAMP       NOT NULL,
    username        VARCHAR (120)   NOT NULL,
    parentmessage   INT,
    PRIMARY KEY (id),
    FOREIGN KEY (username) ON User(username),
    FOREIGN KEY (parentmessage) ON Message(id)
)

CREATE TABLE ThreadMessages (
    threadId        INT             NOT NULL,
    messageId       INT             NOT NULL,
    PRIMARY KEY (threadId, messageId),
    FOREIGN KEY (threadId) ON Thread(id),
    FOREIGN KEY (messageId) ON Message(id) 
)
